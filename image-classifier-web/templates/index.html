{% extends "layout.html" %}

{% block title %}Upload{% endblock %}

{% block content %}
<main class="container">
    <section class="hero">
        <h1>Image Classifier</h1>
        <p>Automated evidence analysis and legal support.</p>
    </section>

    <form id="uploadForm" action="/predict" method="post" enctype="multipart/form-data">
        <div class="main-grid">
            
            <div class="card upload-card">
                <h3 class="card-title">Upload File</h3>
                <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ðŸ“„</div>
                    <p><strong>Drag & drop your files here</strong></p>
                    <p>or click to browse</p>
                    
                    <input type="file" id="fileInput" name="file" accept="image/*" style="display: none;" onchange="handleFileSelect(this)" />
                    
                    <div id="fileNameDisplay" style="margin-top: 10px; font-size: 0.9rem; color: var(--ams-red); font-weight: bold;"></div>
                </div>
                
                <p id="errorMessage" style="color: #ec0000; font-size: 0.85rem; margin-top: 10px; display: none; font-weight: bold;">
                    Please select an image file before starting the analysis.
                </p>
            </div>

            <div class="card settings-card">
                <h3 class="card-title">Settings</h3>
                
                <div class="setting-group">
                    <label>Language</label>
                    <select name="language">
                        <option value="en">English</option>
                        <option value="nl">Nederlands</option>
                    </select>
                </div>

                <div class="setting-group toggle-group">
                    <div>
                        <label>Decision Support</label>
                        <small>Enable AI-powered legal reasoning suggestions</small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" name="decision_support" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="setting-group">
                    <label>Output File Type</label>
                    <div class="radio-options">
                        <label class="radio-item">
                            <input type="radio" name="filetype" value="pdf" checked> PDF
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="filetype" value="docx"> DOCX
                        </label>
                    </div>
                </div>

                <div class="button-wrapper">
                    <button type="submit" class=".btn-start-analysis">
                        Start Analysis <span class="arrow">â†’</span>
                    </button>
                </div>
            </div>
        </div>
    </form>
</main>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const errorMessage = document.getElementById('errorMessage');
    const fileNameDisplay = document.getElementById('fileNameDisplay');

    // Drag & drop visual feedback
    dropZone.ondragover = (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
    };

    dropZone.ondragleave = () => {
        dropZone.classList.remove('drag-over');
    };

    dropZone.ondrop = (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            handleFileSelect(fileInput);
        }
    };

    // Update display en verberg error als bestand gekozen is
    function handleFileSelect(input) {
        if (input.files.length > 0) {
            errorMessage.style.display = 'none';
            fileNameDisplay.innerText = "Selected: " + input.files[0].name;
        }
    }

    // De submit check (Java/Javascript functie)
    document.getElementById('uploadForm').onsubmit = function(e) {
        if (fileInput.files.length === 0) {
            e.preventDefault(); 
            errorMessage.style.display = 'block';
            // Scroll naar de error op kleine schermen
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }
    };
</script>
{% endblock %}